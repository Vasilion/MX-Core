<div class="main-container">
  <ion-searchbar
    placeholder="Search Rider Name or AMA #"
    clearIcon="close-outline"
    showClearButton="focus"
    [(ngModel)]="searchQuery"
    (keydown.enter)="getRiders(searchQuery)"
  ></ion-searchbar>
  <ion-button
    color="light"
    (click)="getRiders(searchQuery)"
    [disabled]="!searchQuery || searchQuery.length === 0"
    class="animate__fadeInUp"
    >Search</ion-button
  >
  <br />
  <ion-spinner *ngIf="isLoading" class="loading-spinner"></ion-spinner>

  <div *ngIf="!isLoading">
    <ion-card class="search-results" *ngIf="!riderSelected">
      <ion-accordion-group *ngIf="riders.length > 0">
        <ion-accordion [value]="r" *ngFor="let r of riders">
          <ion-item
            slot="header"
            color="secondary"
            class="animate__animated animate__fadeIn"
          >
            <ion-label>{{ r.name }} - {{ r.hometown }}</ion-label>
          </ion-item>
          <div class="ion-padding" slot="content">
            <p><strong>Name: </strong> {{ r.name }}</p>
            <p><strong>Ama #: </strong> {{ r.ama_num }}</p>
            <p><strong>City: </strong> {{ r.city }}</p>
            <p><strong>State: </strong> {{ r.state }}</p>
            <p>
              <ion-button
                color="light"
                shape="round"
                size="small"
                (click)="getRiderProfile(r.slug)"
                >View Profile</ion-button
              >
            </p>
          </div>
        </ion-accordion>
      </ion-accordion-group>
    </ion-card>

    <ion-card *ngIf="riderSelected" class="animate__animated animate__fadeIn">
      <p>
        <strong
          >{{ riderProfile?.firstName }} {{ riderProfile?.lastName }}</strong
        >
      </p>
      <p><strong>AMA #: </strong>{{ riderProfile?.ama_num }}</p>
      <p>
        <strong>Birthdate: </strong
        >{{ riderProfile?.birthdate | date : "MM/dd/yyyy" }}
      </p>
      <p><strong>City: </strong>{{ riderProfile?.city }}</p>
      <p><strong>State: </strong>{{ riderProfile?.state }}</p>
    </ion-card>
    <ion-card
      class="race-results"
      *ngIf="riderSelected"
      class="animate__animated animate__fadeInUp"
    >
      <ion-accordion-group>
        <ion-accordion
          [value]="race"
          *ngFor="let race of riderProfile?.raceResults"
        >
          <ion-item slot="header" color="secondary" (click)="clearRaceResult()">
            <ion-label
              ><strong
                >{{ race.venueName || race.eventName }} - {{ race.className }} -
                P{{ race.overallFinish }}</strong
              ></ion-label
            >
          </ion-item>
          <div class="ion-padding" slot="content">
            <p><strong>Venue: </strong>{{ race.venueName }}</p>
            <p><strong>Class: </strong>{{ race.className }}</p>
            <p><strong>Overall: </strong>P{{ race.overallFinish }}</p>
            <p *ngIf="race.moto1 != '0'">
              <strong>Moto 1: </strong>{{ race.moto1 }}
            </p>
            <p *ngIf="race.moto2 != '0'">
              <strong>Moto 2: </strong>{{ race.moto2 }}
            </p>
            <p *ngIf="race.moto3 != '0'">
              <strong>Moto 3: </strong>{{ race.moto3 }}
            </p>
            <p *ngIf="race.points">
              <strong>Points: </strong>{{ race.points }}
            </p>
            <p>
              <ion-button
                *ngIf="eventResult.length == 0"
                color="light"
                (click)="getRaceDetails(race.classSlug)"
                class="animate__fadeInUp"
                >View Race Result</ion-button
              >
              <ion-button
                *ngIf="eventResult.length > 0"
                color="light"
                (click)="clearRaceResult()"
                class="animate__fadeInDown"
                >Hide Race Result</ion-button
              >
            </p>
            <p *ngIf="eventResult.length > 0">
              <ion-list class="animate__animated animate__fadeIn">
                <ion-item *ngFor="let e of eventResult" lines="full">
                  <ion-label>
                    <h2 class="center">
                      <b
                        *ngIf="
                          e.position_in_class == 888 ||
                          e.position_in_class == 88
                        "
                        >DNF</b
                      >
                      <b
                        *ngIf="
                          e.position_in_class != 888 ||
                          e.position_in_class != 88
                        "
                        >{{ e.position_in_class }}</b
                      >&nbsp;{{ e.racer_name }}
                    </h2>
                    <p class="center">
                      <b>Moto 1:</b>&nbsp;{{
                        e.meta.moto1Finish
                      }}&nbsp;|&nbsp;<b>Moto 2 :</b>&nbsp;{{
                        e.meta.moto2Finish
                      }}
                    </p>
                    <p>
                      <ion-button
                        color="secondary"
                        (click)="getRiderProfile(e.racer_slug)"
                        >View Profile</ion-button
                      >
                    </p>
                  </ion-label>
                </ion-item>
              </ion-list>
            </p>
          </div>
        </ion-accordion>
      </ion-accordion-group>
    </ion-card>
  </div>
  <ion-toast
    [isOpen]="showSuccess"
    [message]="searchResultMessage"
    icon="checkmark-circle-sharp"
    [duration]="3000"
    color="primary"
    swipeGesture="vertical"
    (didDismiss)="setOpenSuccess(false)"
    (willPresent)="setOpenSuccess(true)"
  ></ion-toast>
  <ion-toast
    [isOpen]="showFailure"
    [message]="failedResultMessage"
    [duration]="3000"
    icon="alert-sharp"
    color="secondary"
    swipeGesture="vertical"
    (didDismiss)="setOpenFailure(false)"
  ></ion-toast>
</div>
